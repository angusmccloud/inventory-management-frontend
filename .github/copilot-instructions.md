# GitHub Copilot Code Review Instructions

> **Auto-synced from inventory-management-context repository**
> 
> | Field | Value |
> |-------|-------|
> | Constitution Version | 1.1.0 |
> | Generated | 2025-12-09T18:05:20Z |
> | Source | [inventory-management-context](https://github.com/Slalom/inventory-management-context) |

---

## ‚ö†Ô∏è DO NOT EDIT THIS FILE DIRECTLY

This file is automatically generated and synced from the central context repository.
Any manual changes will be overwritten on the next sync.

To update these instructions:
1. Edit the source files in `inventory-management-context`
2. The sync workflow will automatically update this file

---

## üî¥ CRITICAL Rules (MUST Block Merge)

These violations MUST be fixed before any PR can be merged.

### 1. TypeScript Type Safety

- **No implicit `any` types** - All types must be explicit
- **Strict mode required** - `tsconfig.json` must have `"strict": true`
- All function parameters and return types MUST be explicitly typed
- Type assertions must be justified with comments explaining why they are safe
- Shared types MUST be defined in dedicated type definition files

### 2. Testing Requirements

- **Test-first development** - Write tests BEFORE implementation
- **80% coverage required** for critical business logic paths
- Tests MUST use **Jest and React Testing Library** exclusively
- All tests MUST pass before merge
- Mock external dependencies (AWS services, third-party APIs) in unit tests

### 3. Security Standards

- **No secrets or API keys in code** - Use environment variables or AWS Secrets Manager
- All user inputs MUST be validated and sanitized (use Zod)
- CORS and security headers MUST be properly configured
- Authentication required for all protected resources
- OWASP security guidelines MUST be followed

### 4. AWS Best Practices

- **AWS SDK v3 with modular imports only** (tree-shaking optimization)
  ```typescript
  // ‚úÖ Correct
  import { DynamoDBClient } from "@aws-sdk/client-dynamodb";
  import { DynamoDBDocumentClient, GetCommand } from "@aws-sdk/lib-dynamodb";
  
  // ‚ùå Wrong - never import entire SDK
  import AWS from "aws-sdk";
  ```
- **No DynamoDB scan operations** - Use queries with proper indexes
- Lambda functions MUST be stateless and idempotent
- IAM roles MUST follow least-privilege principle

---

## üü† HIGH Priority (Strongly Recommend Fix)

- Missing error handling for AWS service calls
- CORS/security header configuration issues
- Performance optimization opportunities (cold starts, bundle size)
- Missing input validation at API boundaries
- Improper async/await usage (no raw Promises or callbacks)

---

## üü° MEDIUM Priority (Consider Fixing)

- Code organization issues (files not colocated properly)
- Missing or incomplete type definitions
- Documentation improvements needed
- Suboptimal caching strategies
- Code duplication that could be refactored

---

## üü¢ LOW Priority (Optional Improvement)

- Style/formatting suggestions
- Minor naming improvements
- Additional test coverage for edge cases
- Performance micro-optimizations

---

## Technology Stack

| Category | Technology |
|----------|------------|
| **Frontend Framework** | Next.js 16 with App Router |
| **Build Tool** | Vite (NOT Webpack) |
| **Language** | TypeScript 5 strict mode |
| **Runtime** | Node.js 24.x LTS |
| **Backend Deployment** | AWS SAM (Lambda + API Gateway) |
| **Frontend Deployment** | AWS S3 + CloudFront |
| **Database** | Amazon DynamoDB (single-table design) |
| **Testing** | Jest + React Testing Library |
| **Validation** | Zod |

---

## Code Organization Standards

### Next.js App Router Structure

```
app/
‚îú‚îÄ‚îÄ (routes)/           # Route groups
‚îú‚îÄ‚îÄ api/                # API route handlers
‚îú‚îÄ‚îÄ components/         # Shared components
‚îú‚îÄ‚îÄ lib/                # Business logic
‚îú‚îÄ‚îÄ types/              # TypeScript definitions
‚îî‚îÄ‚îÄ utils/              # Utility functions
```

### File Colocation

- Related files MUST be colocated (components, styles, tests together)
- Business logic MUST be separated from presentation components
- AWS SAM template and infrastructure code in project root

---

## DynamoDB Patterns

- **Single-table design** pattern MUST be used
- All queries MUST filter by `familyId` for family isolation
- Use GSI2 for low-stock queries and shopping list filtering
- **NEVER use table scans** - always query with proper indexes
- Use DynamoDB Document Client for all data operations

---

## Authentication & Authorization

- All API endpoints require JWT Bearer token from AWS Cognito
- Family context (`familyId`) extracted from JWT `custom:familyId` claim
- Role-based access control: `admin` (full access) or `suggester` (read + suggest)
- Lambda authorizer validates JWT and injects context

---

## Error Handling

- Use structured error responses with Zod validation errors
- Include correlation IDs in all errors for tracing
- Log errors with CloudWatch structured JSON format
- Return appropriate HTTP status codes (400, 401, 403, 404, 500)

---

## Deployment Requirements

### Frontend (S3 + CloudFront)

- Deploy to AWS S3 as static assets
- CloudFront for CDN and HTTPS
- Invalidate CloudFront cache after each deployment
- SPA routing via CloudFront error pages (404 ‚Üí index.html)
- **Third-party platforms (Vercel, Netlify) MUST NOT be used**

### Backend (AWS SAM)

- Deploy via `sam deploy` command
- Test locally with `sam local` before deployment
- Review API Gateway configurations for CORS and security headers

---

## Review Format

When providing feedback, use this format:

1. **Cite the specific rule** being violated
2. **Explain why it matters** (security, performance, maintainability)
3. **Provide a concrete fix** with code example
4. **Use severity labels**: üî¥ CRITICAL, üü† HIGH, üü° MEDIUM, üü¢ LOW

### Example Review Comment

```
üî¥ CRITICAL: TypeScript Type Safety Violation

**Issue**: Function parameter `data` has implicit `any` type.

**Why it matters**: Implicit any types bypass TypeScript's type checking,
leading to potential runtime errors that could have been caught at compile time.

**Fix**:
```typescript
// Before
function processData(data) { ... }

// After
interface ItemData {
  id: string;
  name: string;
  quantity: number;
}
function processData(data: ItemData): ProcessedResult { ... }
```
```

---

## Quick Reference

| Check | Rule |
|-------|------|
| ‚úÖ | All types explicit (no implicit `any`) |
| ‚úÖ | Tests written before implementation |
| ‚úÖ | 80% coverage for critical paths |
| ‚úÖ | No secrets in code |
| ‚úÖ | AWS SDK v3 modular imports |
| ‚úÖ | No DynamoDB scans |
| ‚úÖ | Proper error handling |
| ‚úÖ | Input validation with Zod |
| ‚úÖ | Async/await (no raw Promises) |
| ‚úÖ | Files properly colocated |

---

*This file is automatically synced from the central context repository.*
*Last sync: 2025-12-09T18:05:20Z*
